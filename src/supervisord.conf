# /src/supervisord.conf
# Configuration file for Supervisor process manager
# Uses /workspace for Jupyter directory

[supervisord]
nodaemon=true       ; Run supervisor in the foreground (required for Docker)
user=root           ; Run supervisor itself as root
logfile=/workspace/logs/supervisord.log ; Log supervisor messages itself (Changed path)
logfile_maxbytes=10MB
logfile_backups=3
pidfile=/tmp/supervisord.pid ; Default pid file location

[program:sshd]
command=/usr/sbin/sshd -D ; Run the SSH daemon in the foreground
autostart=true            ; Start sshd automatically when supervisor starts
autorestart=true          ; Restart sshd if it crashes
priority=10               ; Lower priority means start earlier
stdout_logfile=/workspace/logs/sshd.log ; Changed path
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile=/workspace/logs/sshd_err.log ; Changed path
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3

[program:jupyter]
# Run jupyter lab, listening on all interfaces (0.0.0.0), NO AUTHENTICATION (token/password = '')
command=jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --allow-root --NotebookApp.token='' --NotebookApp.password='' --NotebookApp.allow_origin='*' --NotebookApp.base_url=${JUPYTER_BASE_URL:-/}
# *** Changed directory to /workspace/VisoMaster ***
directory=/workspace/VisoMaster  ; Start Jupyter in the VisoMaster directory
autostart=true              ; Start Jupyter automatically
autorestart=true            ; Restart Jupyter if it crashes
priority=20                 ; Start after sshd
stdout_logfile=/workspace/logs/jupyter.log ; Changed path
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile=/workspace/logs/jupyter_err.log ; Changed path
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3
user=root                   ; Run Jupyter as root

[program:vnc]
# Runs the original VNC startup script from /dockerstartup/
# This script should handle starting the VNC server and the window manager (IceWM)
# Ensure the script inside /dockerstartup/vnc_startup.sh correctly calls the IceWM startup script (e.g., /workspace/wm_startup.sh if ADD target was changed)
command=/dockerstartup/vnc_startup.sh --wait
autostart=true              ; Start VNC automatically
autorestart=true            ; Restart VNC service if it crashes
priority=30                 ; Start after Jupyter
stdout_logfile=/workspace/logs/vnc.log ; Changed path
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile=/workspace/logs/vnc_err.log ; Changed path
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3
user=root                   ; Run VNC startup as root
