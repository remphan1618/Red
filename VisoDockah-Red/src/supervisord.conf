# /src/supervisord.conf
# Configuration file for Supervisor process manager

[supervisord]
nodaemon=true       ; Run supervisor in the foreground (required for Docker)
user=root           ; Run supervisor itself as root

[program:sshd]
command=/usr/sbin/sshd -D ; Run the SSH daemon in the foreground
autostart=true            ; Start sshd automatically when supervisor starts
autorestart=true          ; Restart sshd if it crashes
priority=10               ; Lower priority means start earlier
stdout_logfile=/dev/stdout ; Redirect stdout to container log
stdout_logfile_maxbytes=0  ; Disable log rotation for stdout
stderr_logfile=/dev/stderr ; Redirect stderr to container log
stderr_logfile_maxbytes=0  ; Disable log rotation for stderr

[program:jupyter]
# Run jupyter lab, listening on all interfaces (0.0.0.0), NO AUTHENTICATION (token/password = '')
command=jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --allow-root --NotebookApp.token='' --NotebookApp.password='' --NotebookApp.allow_origin='*' --NotebookApp.base_url=${JUPYTER_BASE_URL:-/}
directory=/root/VisoMaster  ; Start Jupyter in the VisoMaster directory
autostart=true              ; Start Jupyter automatically
autorestart=true            ; Restart Jupyter if it crashes
priority=20                 ; Start after sshd
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
user=root                   ; Run Jupyter as root

[program:vnc]
# Runs the original VNC startup script from /dockerstartup/
# This script should handle starting the VNC server and the window manager (IceWM)
# Ensure the script inside /dockerstartup/vnc_startup.sh correctly calls the IceWM startup script (e.g., /root/wm_startup.sh)
command=/dockerstartup/vnc_startup.sh --wait
autostart=true              ; Start VNC automatically
autorestart=true            ; Restart VNC service if it crashes
priority=30                 ; Start after Jupyter
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
user=root                   ; Run VNC startup as root